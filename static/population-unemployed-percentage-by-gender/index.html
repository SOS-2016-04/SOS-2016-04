<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <script src="js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="container">
<h1>Graphical user interface</h1><br/><br/>
<div class="well">
    <span id="status"></span>
</div>

<div class="col-xs-3">
  <center>
  <button id="removeall" class="btn btn-danger btn-lg">Remove All</button></br></br>
  <button id="loadData" class="btn btn-secondary btn-lg ">Load  Data</button></br></br>
  <button id="all" class="btn btn-success btn-lg">All</button></br></br>
  <button id="add" class="btn btn-success btn-lg">Add</button></br></br>
  <button id="edit" class="btn btn-success btn-lg">Edit</button></br></br>
  <button id="remove" class="btn btn-danger btn-lg">Remove</button></br></br>
  </center>
</div>

<div class="col-xs-3">
</br></br><input id="apikey" class="form-control" placeholder="Apikey" value="clave" ></input></br>
<input id="country" class="form-control" placeholder="Country"></input></br>
<input id="year" class="form-control" placeholder="Year"></input></br>
<input id="female" class="form-control" placeholder="Female"></input></br>
<input id="male" class="form-control" placeholder="Male"></input></br>
</div>

<div class="col-xs-3">
  <button id="search" class="btn btn-primary btn-block">Search</button></br>
</br></br> <input id="from" class="form-control" placeholder="From"></input> </br>   <input id="to" class="form-control" placeholder="To"></input></br>
</div>
<!--<div class="col-xs-3">
Pagination: </br></br> <select id= "pag" name="pag" class="form-control">
   <option value="0">0  Element</option>
   <option value="1">1</option>
   <option value="2">2</option>
   <option value="3">3</option>
</select></br> <input id="pag2" class="form-control" type="hidden" value="0"></input>
</div>-->

<table id="tabla" class="table">
  <thead>
    <tr>
    <th>Countries</th>
    <th>Year</th>
    <th>Female</th>
    <th>Male</th>
    </tr>
  </thead>
</table>

<!--<div class="col-xs-2">
<button id="anterior" class="btn btn-primary btn-block">Previous</button>
</div>
<div class="col-xs-2">
<button id="siguiente" class="btn btn-primary btn-block">Next</button>
</div>-->
</div>
	<script>
	function refrescar(apikey){
		$.ajax(
			{
				type: "GET",
				url:"/api/v1/population-unemployed-percentage-by-gender?apikey="+apikey,
				data: "{}",
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				cache: false,
				success: function (data) {
					var trHTML = '';
				$.each(data, function (i, item) {
					trHTML += '<thead><tr><td>' + item.country + '</td><td>' + item.year + '</td><td>' + item.female + '</td><td>' + item.male + '</td></tr></thead>';
				});
				$('#tabla').append(trHTML);
				}

	   		 });
	}

		$("#loadData").click(function(){
			$("#tabla td").remove();
        var apikey = $("#apikey").val();
        var request = $.ajax({
            url:"/api/v1/population-unemployed-percentage-by-gender/loadInitialData?apikey="+apikey,
            type:"GET",
            contentType : "application/json"
   		     });
        		request.always(function(jqXHR,status){
				        errores(jqXHR,status);
				});
        refrescar(apikey);
  		});

/*function myFunction2() {
    document.getElementById("pag2").value = 0;
}*/
  		$("#search").click(function(){
 		 $("#tabla td").remove();
 		 //myFunction2();
     var dobles_comillas = String.fromCharCode(34);
  		var apikey = $("#apikey").val();
        var y = $("#year").val();
        var c = $("#country").val();
        var desde = $("#from").val();
        var hasta = $("#to").val();
        //var pag = $("#pag").val();
      //  var pag2 = $("#pag2").val();
      if(y != ""){
				y = "/"+y;
			}
			if(c != ""){
				c= "/" + c;
			}
			if(desde != ""){
				desde = "&from=" + desde;
			}
			if(hasta != ""){
				hasta = "&to=" + hasta;
			}
		/*	if(pag != ""){
				pag = "&limit=" + pag;
			}
			if(pag2 != ""){
				pag2 = "&offset=" + pag2;
			}*/
      var request = $.ajax(
			{
				type: "GET",
				url:"/api/v1/population-unemployed-percentage-by-gender"+c+y+"?apikey="+apikey + desde + hasta, //+ pag2 + pag,
				data: "{}",
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				cache: false,
				success: function (data) {
					var trHTML = '';
				$.each(data, function (i, item) {
					trHTML += '<thead><tr><td>' + item.country + '</td><td>' + item.year + '</td><td>' + item.female + '</td><td>' + item.male + '</td></tr></thead>';
				});
				$('#tabla').append(trHTML);
				}
	   		 });
			request.always(function(jqXHR,status){
				errores(jqXHR,status);
				});
	});
/*function myFunction(pag3) {
    document.getElementById("pag2").value = pag3;
}
$("#siguiente").click(function(){
 		 $("#location td").remove();
  		var apikey = $("#apikey").val();
        var year = $("#year").val();
        var country = $("#country").val();
        var desde = $("#desde").val();
        var hasta = $("#hasta").val();
        var pag = $("#pag").val();
        var pag2 = $("#pag2").val();
        pag3 = parseInt(pag) + parseInt(pag2);
			if(year != ""){
				year = "/"+year;
			}
			if(country != ""){
				country = "/" + country;
			}
			if(desde != ""){
				desde = "&from=" + desde;
			}
			if(hasta != ""){
				hasta = "&to=" + hasta;
			}
			if(pag != ""){
				pag = "&limit=" + pag;
			}
			if(pag2 != ""){
				pag2 = "&offset=" + pag3;
			}
          var request = $.ajax(
			{
				type: "GET",
				url:"https://sos-2016-13.herokuapp.com/api/v1/consumed" + country + year + "?apikey="+apikey + desde + hasta + pag2 + pag,
				data: "{}",
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				cache: false,
				success: function (data) {
					var trHTML = '';
				$.each(data, function (i, item) {
					if(item != null){
					trHTML += '<thead><tr><td>' + item.country + '</td><td>' + item.year + '</td><td>' + item.petroleum_cost + '</td><td>' + item.electric_cost + '</td></tr></thead>';
					anterior.disabled = false;
				}else{
					siguiente.disabled = true;
					}
				});
				$('#location').append(trHTML);
				},
				error: function (msg) {
					alert(msg.responseText);
				}
	   		 });
        	  myFunction(pag3);
			request.always(function(jqXHR,status){
				errores(jqXHR,status);
				});
	});
$("#anterior").click(function(){
 		 $("#location td").remove();
  		var apikey = $("#apikey").val();
        var year = $("#year").val();
        var country = $("#country").val();
        var desde = $("#desde").val();
        var hasta = $("#hasta").val();
        var pag = $("#pag").val();
        var pag2 = $("#pag2").val();
        pag3 = parseInt(pag2) - parseInt(pag);
			if(year != ""){
				year = "/"+year;
			}
			if(country != ""){
				country = "/" + country;
			}
			if(desde != ""){
				desde = "&from=" + desde;
			}
			if(hasta != ""){
				hasta = "&to=" + hasta;
			}
			if(pag != ""){
				pag = "&limit=" + pag;
			}
			if(pag2 != ""){
				pag2 = "&offset=" + pag3;
			}
          var request = $.ajax(
			{
				type: "GET",
				url:"https://sos-2016-13.herokuapp.com/api/v1/consumed" + country + year + "?apikey="+apikey + desde + hasta + pag2 + pag,
				data: "{}",
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				cache: false,
				success: function (data) {
					var trHTML = '';
				$.each(data, function (i, item) {
					if(item != null){
					trHTML += '<thead><tr><td>' + item.country + '</td><td>' + item.year + '</td><td>' + item.petroleum_cost + '</td><td>' + item.electric_cost + '</td></tr></thead>';
					siguiente.disabled = false;
					}else{
						anterior.disabled = true;
					}
				});
				$('#location').append(trHTML);
				},
				error: function (msg) {
					alert(msg.responseText);
				}
	   		 });

          myFunction(pag3);

			request.always(function(jqXHR,status){
				errores(jqXHR,status);
				});
	});*/

  		$("#add").click(function(){
		$("#tabla td").remove();
        var apikey = $("#apikey").val();
        var country = $("#country").val();
        var year = $("#year").val();
        var female = $("#female").val();
        var male = $("#male").val();
		       	var request = $.ajax({
		            url:"/api/v1/population-unemployed-percentage-by-gender?apikey="+apikey,
		            type:"POST",
		            data: '{"country":"'+country+'","year":'+year+',"female":'+female+',"male":'+male+'}',
		            contentType : "application/json"
		   		     });
        		request.always(function(jqXHR,status){
              errores(jqXHR,status);
				});
				refrescar(apikey);
  		});

  		$("#edit").click(function(){
		$("#tabla td").remove();
        var apikey = $("#apikey").val();
        var country = $("#country").val();
        var year = $("#year").val();
        var female = $("#female").val();
        var male = $("#male").val();
        var request = $.ajax({
            url:"/api/v1/population-unemployed-percentage-by-gender/" + country + "/" + year + "?apikey="+apikey,
            type:"PUT",
            data: '{"country":"'+country+'","year":'+year+',"female":'+female+',"male":'+male+'}',
            contentType : "application/json"
   		     });
        		request.always(function(jqXHR,status){
              errores(jqXHR,status);
				});
				refrescar(apikey);
  		});

  		$("#remove").click(function(){
		$("#tabla td").remove();
        var apikey = $("#apikey").val();
        var country = $("#country").val();
        var year = $("#year").val();
        var request = $.ajax({
            url:"/api/v1/population-unemployed-percentage-by-gender/" + country + "/" + year + "?apikey="+apikey,
            type:"DELETE",
            contentType : "application/json"
   		     });
        		request.always(function(jqXHR,status){
              errores(jqXHR,status);
				});
				refrescar(apikey);
  		});

 		$("#removeall").click(function(){
			$("#tabla td").remove();
        var apikey = $("#apikey").val();
        	var request = $.ajax({
            url:"/api/v1/population-unemployed-percentage-by-gender?apikey="+apikey,
            type:"DELETE",
            contentType : "application/json"
   		     });
       		 request.always(function(jqXHR,status){
             errores(jqXHR,status);
				});
       		 refrescar(apikey);
  		});

		$("#all").click(function(){
			$("#tabla td").remove();
		var apikey = $("#apikey").val();
		var request = $.ajax(
		{
			type: "GET",
			url: '/api/v1/population-unemployed-percentage-by-gender?apikey='+apikey,
			data: "{}",
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			cache: false,
			success: function (data) {
				var trHTML = '';
			$.each(data, function (i, item) {
				trHTML += '<thead><tr><td>' + item.country + '</td><td>' + item.year + '</td><td>' + item.female + '</td><td>' + item.male + '</td></tr></thead>';
			});
			$('#tabla').append(trHTML);
			}

   		 });
				request.always(function(jqXHR,status){
				errores(jqXHR,status);
				});
	});
function errores(jqXHR,status){
	if(status=="error"){
					if(jqXHR.status == "401"){
						alert("Apikey incorrect, please insert new apikey.");
					}else if (jqXHR.status == "409"){
						alert("You can´t add that data, this data already exists.");
					}
        }
			};
	</script>



</body>
</html>
